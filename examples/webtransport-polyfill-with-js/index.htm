<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script src="../../packages/webtransport-polyfill/dist/index.global.js"></script>

    <script>
      async function init() {
        const transport = new WebTransport('ws://localhost:8080/');

        transport.closed
          .then(() => {
            console.log('连接优雅关闭');
          })
          .catch(error => {
            console.log('连接关闭失败');
          });

        await transport.ready;
        // 连接准备就绪

        // 向服务端发送两个数据报
        const writer = transport.datagrams.writable.getWriter();
        // ABC
        const data1 = new Uint8Array([65, 66, 67]);
        // DEF
        const data2 = new Uint8Array([68, 69, 70]);
        writer.write(data1);
        writer.write(data2);

        // 从服务端读取数据报
        const reader = transport.datagrams.readable.getReader();
        while (true) {
          const { value, done } = await reader.read();
          if (done) {
            break;
          }
          console.log('服务端返回的数据报：', value);
        }
      }

      init();
    </script>
  </body>
</html>
